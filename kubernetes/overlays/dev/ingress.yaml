# ---
# apiVersion: traefik.containo.us/v1alpha1
# kind: IngressRoute

# metadata:
#   name: api-v1

# spec:
#   entryPoints:
#     - web
#   routes:
#     - match: Host(`api.catalog.dev.sweetrpg.com`) && (PathPrefix(`/0/`) || PathPrefix(`/1/`))
#       kind: Rule
#       services:
#         - kind: Service
#           name: api-v1
#           port: 8281
#           passHostHeader: true
#           responseForwarding:
#             flushInterval: 1ms
#       middlewares:
#         - name: strip-prefix
#
---
apiVersion: networking.k8s.io/v1
kind: Ingress

metadata:
  name: api-v1
  annotations:
    traefik.ingress.kubernetes.io/router.entrypoints: web,websecure
    traefik.ingress.kubernetes.io/router.tls: "true"
    kubernetes.io/ingress.class: traefik
    cert-manager.io/cluster-issuer: letsencrypt-prd
    reloader.homer/name: Catalog API
    reloader.homer/group: sweetrpg
    reloader.homer/subtitle: API for SweetRPG catalog service
    reloader.homer/logo: https://avatars.githubusercontent.com/u/43730988?s=200&v=4
    reloader.homer/tag: catalog
    reloader.homer/prio: "1"

spec:
  rules:
    - host: api.catalog.dev.sweetrpg.com
      http:
        paths:
          - pathType: Prefix
            path: /
            backend:
              service:
                name: api-v1
                port:
                  number: 8281
  tls:
    - hosts:
        - api.catalog.dev.sweetrpg.com
      secretName: catalog-api-v1-tls
