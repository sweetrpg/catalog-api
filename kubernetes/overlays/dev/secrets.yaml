---
apiVersion: external-secrets.io/v1beta1
kind: ClusterExternalSecret

metadata:
    name: catalog-api-auth

spec:
    externalSecretName: api-auth

    namespaceSelector:
        matchLabels:
            kubernetes.io/metadata.name: sweetrpg-catalog

    refreshTime: 1m

    externalSecretSpec:
        refreshInterval: "1h"
        secretStoreRef:
            name: akeyless
            kind: ClusterSecretStore
        target:
            name: api-auth
            creationPolicy: Owner
        dataFrom:
            - extract:
                  key: Auth0

---
apiVersion: external-secrets.io/v1beta1
kind: ClusterExternalSecret

metadata:
    name: catalog-api-db

spec:
    externalSecretName: api-db

    namespaceSelector:
        matchLabels:
            kubernetes.io/metadata.name: sweetrpg-catalog

    refreshTime: 1m

    externalSecretSpec:
        refreshInterval: 1h
        secretStoreRef:
            name: akeyless
            kind: ClusterSecretStore
        target:
            name: api-db
            creationPolicy: Owner
        dataFrom:
            - extract:
                  key: /sweetrpg/catalog/api/db

---
apiVersion: external-secrets.io/v1beta1
kind: ClusterExternalSecret

metadata:
    name: catalog-api-misc

spec:
    externalSecretName: api-misc

    namespaceSelector:
        matchLabels:
            kubernetes.io/metadata.name: sweetrpg-catalog

    refreshTime: 1m

    externalSecretSpec:
        refreshInterval: 1h
        secretStoreRef:
            name: akeyless
            kind: ClusterSecretStore
        target:
            name: api-misc
            creationPolicy: Owner
        dataFrom:
            - extract:
                  key: /sweetrpg/catalog/api/misc

---
apiVersion: external-secrets.io/v1beta1
kind: ClusterExternalSecret

metadata:
    name: catalog-api-cache

spec:
    externalSecretName: api-cache

    namespaceSelector:
        matchLabels:
            kubernetes.io/metadata.name: sweetrpg-catalog

    refreshTime: 1m

    externalSecretSpec:
        refreshInterval: 1h
        secretStoreRef:
            name: akeyless
            kind: ClusterSecretStore
        target:
            name: api-cache
            creationPolicy: Owner
        dataFrom:
            - extract:
                  key: /sweetrpg/support/cache/client

---
apiVersion: external-secrets.io/v1beta1
kind: ClusterExternalSecret

metadata:
    name: catalog-api-files

spec:
    externalSecretName: api-files

    namespaceSelector:
        matchLabels:
            kubernetes.io/metadata.name: sweetrpg-catalog

    refreshTime: 1m

    externalSecretSpec:
        refreshInterval: 1h
        secretStoreRef:
            name: akeyless
            kind: ClusterSecretStore
        target:
            name: api-files
            creationPolicy: Owner
            template:
                type: Opaque
                data:
                    newrelic.ini: "{{ .contents | toString }}"
        data:
            - secretKey: contents
              remoteRef:
                  key: NewRelic
